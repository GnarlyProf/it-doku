@using ITDoku.Models
@model IEnumerable<DeviceIp>

@{
    var objectName = ViewBag.ObjectName as string ?? "Objekt";
    var objectId = ViewBag.ObjectId is Guid g ? g : Guid.Empty;
    ViewData["Title"] = $"IP-Adressen – {objectName}";
}

<div class="d-flex justify-content-between align-items-center">
    <h4 class="mb-0">
        <i class="bi bi-hdd-network me-2 opacity-75"></i>@ViewData["Title"]
    </h4>
    <div class="d-flex gap-2">
        <a class="btn btn-sm btn-outline-secondary"
           asp-controller="Objects" asp-action="Index" asp-route-id="@objectId">
            <i class="bi bi-arrow-left-short me-1"></i>Zurück zum Objekt
        </a>
        <a class="btn btn-sm btn-success"
           asp-action="Create" asp-route-dokuObjectId="@objectId">
            <i class="bi bi-plus-lg me-1"></i>IP hinzufügen
        </a>
    </div>
</div>
<hr />

@if (Model == null || !Model.Any())
{
    <div class="alert alert-info">
        Für <strong>@objectName</strong> sind noch keine IP-Adressen hinterlegt.
        <a class="alert-link" asp-action="Create" asp-route-dokuObjectId="@objectId">Jetzt IP hinzufügen</a>.
    </div>
}
else
{
    <div class="table-responsive">
        <table class="table table-sm align-middle">
            <thead>
                <tr>
                    <th style="width: 18%;">Interface</th>
                    <th style="width: 12%;">Zuweisung</th>
                    <th style="width: 24%;">IP / Maske</th>
                    <th style="width: 20%;">Gateway</th>
                    <th style="width: 10%;">VLAN</th>
                    <th class="text-end" style="width: 16%;">Aktionen</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var ip in Model.OrderBy(x => x.InterfaceName).ThenBy(x => x.IpAddress))
                {
                    <tr>
                        <td class="font-monospace">
                            @if (!string.IsNullOrWhiteSpace(ip.InterfaceName))
                            {
                                @ip.InterfaceName
                            }
                            else
                            {
                                <span class="text-muted">—</span>
                            }
                        </td>
                        <td>
                            @if (ip.AssignmentType == IpAssignmentType.DHCP)
                            {
                                <span class="badge text-bg-secondary">DHCP</span>
                            }
                            else
                            {
                                <span class="badge text-bg-primary">Static</span>
                            }
                        </td>
                        <td class="font-monospace">
                            @ip.IpAddress
                            @if (!string.IsNullOrWhiteSpace(ip.SubnetMask))
                            {
                                <span class="text-muted"> / @ip.SubnetMask</span>
                            }
                        </td>
                        <td class="font-monospace">
                            @if (!string.IsNullOrWhiteSpace(ip.Gateway))
                            {
                                @ip.Gateway
                            }
                            else
                            {
                                <span class="text-muted">—</span>
                            }
                        </td>
                        <td>
                            @if (ip.VlanId.HasValue)
                            {
                                <span class="badge text-bg-light">VLAN @ip.VlanId</span>
                            }
                            else
                            {
                                <span class="text-muted">—</span>
                            }
                        </td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-primary me-1"
                               asp-action="Edit" asp-route-id="@ip.DeviceIpId">
                                <i class="bi bi-pencil-square me-1"></i>Bearbeiten
                            </a>
                            <form asp-action="Delete" asp-route-id="@ip.DeviceIpId" method="post"
                                  class="d-inline" onsubmit="return confirm('Diese IP löschen?');">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="bi bi-trash me-1"></i>Löschen
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
